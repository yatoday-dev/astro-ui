---
/**
 * SEO Component - Proper multilingual SEO meta tags without hacks
 * Handles canonical URLs, OpenGraph, Twitter Cards, and i18n correctly
 */

export interface SEOProps {
  title?: string;
  description?: string;
  canonical?: string;
  locale?: string;
  alternateLocales?: Array<{ locale: string; url: string }>;
  robots?: {
    index?: boolean;
    follow?: boolean;
  };
  openGraph?: {
    title?: string;
    description?: string;
    url?: string;
    type?: string;
    image?: {
      url: string;
      width?: number;
      height?: number;
      alt?: string;
    };
    siteName?: string;
  };
  twitter?: {
    card?: 'summary' | 'summary_large_image' | 'app' | 'player';
    site?: string;
    creator?: string;
    title?: string;
    description?: string;
    image?: string;
  };
}

const {
  title,
  description,
  canonical,
  locale = 'en',
  alternateLocales = [],
  robots = { index: true, follow: true },
  openGraph,
  twitter,
} = Astro.props as SEOProps;

// Build robots content
const robotsContent = [
  robots.index !== false ? 'index' : 'noindex',
  robots.follow !== false ? 'follow' : 'nofollow',
].join(',');

// Determine OpenGraph locale format (e.g., en_US, ru_RU, es_ES)
const getOGLocale = (loc: string): string => {
  const localeMap: Record<string, string> = {
    en: 'en_US',
    ru: 'ru_RU',
    es: 'es_ES',
  };
  return localeMap[loc] || loc;
};
---

<!-- Primary Meta Tags -->
{title && <title>{title}</title>}
{description && <meta name="description" content={description} />}
{canonical && <link rel="canonical" href={canonical} />}
<meta name="robots" content={robotsContent} />

<!-- Open Graph / Facebook -->
{openGraph && (
  <>
    {openGraph.title && <meta property="og:title" content={openGraph.title} />}
    {openGraph.description && <meta property="og:description" content={openGraph.description} />}
    {openGraph.url && <meta property="og:url" content={openGraph.url} />}
    {openGraph.type && <meta property="og:type" content={openGraph.type} />}
    {openGraph.image && (
      <>
        <meta property="og:image" content={openGraph.image.url} />
        {openGraph.image.width && <meta property="og:image:width" content={openGraph.image.width.toString()} />}
        {openGraph.image.height && <meta property="og:image:height" content={openGraph.image.height.toString()} />}
        {openGraph.image.alt && <meta property="og:image:alt" content={openGraph.image.alt} />}
      </>
    )}
    <meta property="og:locale" content={getOGLocale(locale)} />
    {openGraph.siteName && <meta property="og:site_name" content={openGraph.siteName} />}
  </>
)}

<!-- Alternate Language Links (hreflang) -->
{alternateLocales.map(({ locale: altLocale, url }) => (
  <link rel="alternate" hreflang={altLocale} href={url} />
))}

<!-- Twitter Card -->
{twitter && (
  <>
    <meta name="twitter:card" content={twitter.card || 'summary_large_image'} />
    {twitter.site && <meta name="twitter:site" content={twitter.site} />}
    {twitter.creator && <meta name="twitter:creator" content={twitter.creator} />}
    {twitter.title && <meta name="twitter:title" content={twitter.title} />}
    {twitter.description && <meta name="twitter:description" content={twitter.description} />}
    {twitter.image && <meta name="twitter:image" content={twitter.image} />}
  </>
)}
