---
import SeoMetadata from '../Metadata/Metadata.astro';
import SeoSiteVerification from '../SiteVerification/SiteVerification.astro';
import SeoAnalytics from '../Analytics/Analytics.astro';
import SeoAnalyticsGTMBody from '../Analytics/AnalyticsGTMBody.astro';
import type { LayoutProps as Props } from './types';

import { I18N } from 'vendor:config';

const { metadata = {}, class: className } = Astro.props;
const { language, textDirection, locales, defaultLocale } = I18N;

// Use current locale from Astro's i18n routing, fallback to config
const currentLang = Astro.currentLocale || language;

// Build i18n config for Metadata component (for hreflang generation)
// Allow page-level override via metadata.i18n for single-language pages
const globalI18nConfig = locales?.length ? { locales, defaultLocale: defaultLocale || language } : undefined;
const i18nConfig = metadata.i18n || globalI18nConfig;
---

<!doctype html>
<html lang={currentLang} dir={textDirection} class={className}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <SeoMetadata {...metadata} i18n={i18nConfig} />

    <slot name="head" />
    <slot name="styles" />

    <SeoSiteVerification />
    <SeoAnalytics />
  </head>

  <body class="antialiased bg-background text-foreground tracking-tight">
    <SeoAnalyticsGTMBody />

    <slot />

    <slot name="scripts" />
  </body>
</html>
